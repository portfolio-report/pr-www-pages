import{_ as B}from"./DrKB0r0j.js";import{c as T,e as W,a as x,b as F}from"./DD-PQBUc.js";import{u as O}from"./BXmtjEfx.js";import{q as z,r as m,w as L,c as N,j as i,x as a,y as p,u as t,A as f,z as k,W as y,X as c,Y as h,h as n,i as Y,G as R,F as S}from"./3nNjZsxn.js";import{a as j}from"./DVcyL3FB.js";import{a as w}from"./iPOfHHD9.js";import{s as q,a as g}from"./B3R49ug0.js";import{s as E}from"./Sumk5JQH.js";import{s as G}from"./lTrqJhJ8.js";import"./DlAUqK2U.js";import"./QdMRRk4p.js";import"./CuTaGDLu.js";const X={class:"flex items-end",style:{height:"400px"}},oe=z({__name:"weekly",setup(H){const o=m(new Date().getFullYear()),d=m();function $(s){d.value.toggle(s)}const v=m(new Date),_=j(v),{data:u,pending:C,refresh:b}=T(`statsWeeks:${o.value}`,async()=>{const s=await O(`/stats/updates/weeks?year=${o.value}`);for(const e of s)e.firstUpdate&&(e.firstUpdate=new Date(e.firstUpdate)),e.lastUpdate&&(e.lastUpdate=new Date(e.lastUpdate));return v.value=new Date,{weeks:s.sort((e,l)=>e.week-l.week)}});L(o,()=>b());const D=N(()=>{var s,e;return{labels:(s=u.value)==null?void 0:s.weeks.map(l=>l.week),datasets:[{backgroundColor:"#3B82F6",data:(e=u.value)==null?void 0:e.weeks.map(l=>l.count)}]}}),U={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}}};function A(s){S(s)}return(s,e)=>{const l=B;return n(),i("div",null,[a(t(q),null,{default:p(()=>[a(t(w),{label:"Versions",icon:"i-carbon-tag",class:"p-button-secondary",onClick:e[0]||(e[0]=r=>A("/stats"))}),a(t(w),{label:"Weekly",icon:"i-carbon-calendar",class:"p-button-primary",disabled:!0})]),_:1}),f("h2",null,[e[4]||(e[4]=k(" Weekly Statistics for ")),f("a",{class:"cursor-pointer text-blue-500",onClick:$},y(t(o)),1)]),a(t(G),{ref_key:"yearOverlay",ref:d},{default:p(()=>[a(t(w),{icon:"i-carbon-close-large",rounded:"","icon-class":"text-xl",class:"position-absolute top-0 right-0 transform translate-x-1/2 -translate-y-1/2",onClick:e[1]||(e[1]=r=>t(d).hide())}),a(t(W),{modelValue:t(o),"onUpdate:modelValue":e[2]||(e[2]=r=>Y(o)?o.value=r:null),"use-grouping":!1},null,8,["modelValue"])]),_:1},512),t(C)||!t(u)?(n(),i(c,{key:0},[a(t(g),{width:"15em"}),f("div",X,[(n(),i(c,null,h([30,25,45,70,90],(r,V)=>a(t(g),{key:V,width:"20%",height:`${r}%`,class:"mr-2"},null,8,["height"])),64))]),(n(!0),i(c,null,h(Array(10).keys(),r=>(n(),R(t(g),{key:r,class:"mt-4"}))),128))],64)):(n(),i(c,{key:1},[k(" Last updated "+y(t(_))+" ",1),a(l,{small:"",icon:"i-carbon-renew",onClick:e[3]||(e[3]=r=>t(b)())}),a(t(E),{type:"line",data:t(D),options:U,style:{height:"400px"}},null,8,["data"]),a(t(F),{value:t(u).weeks,"sort-field":"week",class:"font-mono",size:"small","sort-order":-1},{default:p(()=>[a(t(x),{field:"week",header:"Week",sortable:!0},{body:p(r=>[k(y(r.data.week),1)]),_:1}),a(t(x),{field:"count",header:"Count",sortable:!0,class:"!text-right"})]),_:1},8,["value"])],64))])}}});export{oe as default};
