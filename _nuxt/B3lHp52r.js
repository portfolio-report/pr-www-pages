import{_ as B}from"./DFD0y_Ng.js";import{a as T}from"./CyMCfj7K.js";import{a as m}from"./CYX3GZJZ.js";import{s as F,a as f}from"./Ca4qlqln.js";import{s as O}from"./BSlv4X6t.js";import{c as W,e as z,a as x,b as L}from"./CdgON6hT.js";import{s as N}from"./DyoiCi1A.js";import{u as S}from"./0ZkFnHae.js";import{q as R,r as k,w as Y,c as j,j as i,x as a,y as p,u as t,A as y,z as w,Q as g,S as c,U as h,h as n,i as q,G as E,F as G}from"./CRYZwY3H.js";import"./DlAUqK2U.js";import"./CoLUwiqn.js";import"./CVCtVhqw.js";import"./rDXeFEtc.js";const Q={class:"flex items-end",style:{height:"400px"}},le=R({__name:"weekly",setup(H){const o=k(new Date().getFullYear()),d=k();function $(s){d.value.toggle(s)}const v=k(new Date),_=T(v),{data:u,refresh:b,status:U}=W(`statsWeeks:${o.value}`,async()=>{const s=await S(`/stats/updates/weeks?year=${o.value}`);for(const e of s)e.firstUpdate&&(e.firstUpdate=new Date(e.firstUpdate)),e.lastUpdate&&(e.lastUpdate=new Date(e.lastUpdate));return v.value=new Date,{weeks:s.sort((e,l)=>e.week-l.week)}});Y(o,()=>b());const C=j(()=>{var s,e;return{labels:(s=u.value)==null?void 0:s.weeks.map(l=>l.week),datasets:[{backgroundColor:"#3B82F6",data:(e=u.value)==null?void 0:e.weeks.map(l=>l.count)}]}}),D={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}}};function A(s){G(s)}return(s,e)=>{const l=B;return n(),i("div",null,[a(t(F),null,{default:p(()=>[a(t(m),{label:"Versions",icon:"i-carbon-tag",class:"p-button-secondary",onClick:e[0]||(e[0]=r=>A("/stats"))}),a(t(m),{label:"Weekly",icon:"i-carbon-calendar",class:"p-button-primary",disabled:!0})]),_:1}),y("h2",null,[e[4]||(e[4]=w(" Weekly Statistics for ")),y("a",{class:"cursor-pointer text-blue-500",onClick:$},g(t(o)),1)]),a(t(N),{ref_key:"yearOverlay",ref:d},{default:p(()=>[a(t(m),{icon:"i-carbon-close-large",rounded:"","icon-class":"text-xl",class:"position-absolute top-0 right-0 transform translate-x-1/2 -translate-y-1/2",onClick:e[1]||(e[1]=r=>t(d).hide())}),a(t(z),{modelValue:t(o),"onUpdate:modelValue":e[2]||(e[2]=r=>q(o)?o.value=r:null),"use-grouping":!1},null,8,["modelValue"])]),_:1},512),t(U)==="pending"||!t(u)?(n(),i(c,{key:0},[a(t(f),{width:"15em"}),y("div",Q,[(n(),i(c,null,h([30,25,45,70,90],(r,V)=>a(t(f),{key:V,width:"20%",height:`${r}%`,class:"mr-2"},null,8,["height"])),64))]),(n(!0),i(c,null,h(Array(10).keys(),r=>(n(),E(t(f),{key:r,class:"mt-4"}))),128))],64)):(n(),i(c,{key:1},[w(" Last updated "+g(t(_))+" ",1),a(l,{small:"",icon:"i-carbon-renew",onClick:e[3]||(e[3]=r=>t(b)())}),a(t(O),{type:"line",data:t(C),options:D,style:{height:"400px"}},null,8,["data"]),a(t(L),{value:t(u).weeks,"sort-field":"week",class:"font-mono",size:"small","sort-order":-1},{default:p(()=>[a(t(x),{field:"week",header:"Week",sortable:!0},{body:p(r=>[w(g(r.data.week),1)]),_:1}),a(t(x),{field:"count",header:"Count",sortable:!0,class:"!text-right"})]),_:1},8,["value"])],64))])}}});export{le as default};
