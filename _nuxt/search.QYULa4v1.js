import{h as I,l as g,t as l,m as d,q as h,x as u,r as v,B as ee,p as te,C as ne,D as oe,c as ae,j as se,w as re,A as le,E as ue,s as i,u as f,F as w,G as D,v as r,z as ce,i as $,H as T,I as V,J as P,K as j,y as ie,_ as pe}from"./entry.6_jzcU37.js";import{_ as fe}from"./SecurityTag.ZglsENrh.js";import{u as de}from"./useApi.o_3n0OIl.js";import"./_plugin-vue_export-helper.x3n3nnut.js";const me={class:"p-float-label"},ye=u("label",null,"Security Type",-1),_e=I({__name:"SelectSecurityType",props:{modelValue:{}},emits:["update:modelValue"],setup(t,{emit:e}){const p=e,m=[{text:"*",value:""},{text:"share",value:"share"},{text:"fund",value:"fund"},{text:"bond",value:"bond"},{text:"index",value:"index"}];function a(s){p("update:modelValue",s)}return(s,b)=>{const y=g("Dropdown");return l(),d("span",me,[h(y,{class:"w-full","model-value":s.modelValue,options:m,"option-label":"text","option-value":"value","show-clear":!0,"onUpdate:modelValue":a},null,8,["model-value"]),ye])}}}),he=Symbol.for("nuxt:client-only"),ve=I({name:"ClientOnly",inheritAttrs:!1,props:["fallback","placeholder","placeholderTag","fallbackTag"],setup(t,{slots:e,attrs:p}){const m=v(!1);return ee(()=>{m.value=!0}),te(he,!0),a=>{var _;if(m.value)return(_=e.default)==null?void 0:_.call(e);const s=e.fallback||e.placeholder;if(s)return s();const b=a.fallback||a.placeholder||"",y=a.fallbackTag||a.placeholderTag||"span";return d(y,p,b)}}});function A(t){const e=Object.prototype.toString.call(t);return t instanceof Date||typeof t=="object"&&e==="[object Date]"?new t.constructor(+t):typeof t=="number"||e==="[object Number]"||typeof t=="string"||e==="[object String]"?new Date(t):new Date(NaN)}const be=864e5;function O(t){const e=A(t);return e.setHours(0,0,0,0),e}function U(t){const e=A(t),p=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()));return p.setUTCFullYear(e.getFullYear()),+t-+p}function ge(t,e){const p=O(t),m=O(e),a=+p-U(p),s=+m-U(m);return Math.round((a-s)/be)}const we={class:"flex justify-content-center"},Te={style:{width:"800px"}},xe={class:"p-float-label mt-2"},Se=u("label",{for:"searchTermInput"},"ISIN/WKN/Symbol/Name",-1),De={key:0,class:"font-bold"},ke=u("br",null,null,-1),qe={class:"text-lg font-medium flex align-items-center"},Ce={class:"text-600"},Ve=u("ul",null,[u("li",null,[r(" Actively maintain and develop the "),u("a",{href:"https://www.github.com/portfolio-report"},"source code on Github"),r(". ")]),u("li",null,[r(" Become member of the "),u("a",{href:"https://forum.portfolio-performance.info"},"forum"),r(" and help other users. ")]),u("li",null,[r(" Cover monthly costs for server operation and licence fees. Become sponsor on "),u("a",{href:"https://github.com/sponsors/tfabritius"},"Github"),r(". ")])],-1),Be=I({__name:"search",setup(t){const e=ne(),p=oe(),m=ae(()=>{let n="https://www.portfolio-report.net/search";return e.query&&e.query.q&&(n+=`?q=${e.query.q}`,e.query.securityType&&(n+=`&securityType=${e.query.securityType}`)),n});se({title:"Portfolio Report Search",link:[{rel:"canonical",href:m.value}]});const a=v(""),s=v(""),b=v([]),y=v(!1),_=v(!1),k=v(!1),N=v("");R(),q(),re(()=>e.query.q,()=>{e.query.q&&(R(),q())});async function Y(){F(),await q()}function R(){a.value=e.query.q,s.value=e.query.securityType||""}function F(){const n={q:a.value};s.value&&(n.securityType=s.value),p.push({path:e.path,query:n})}async function q(){if(a.value){_.value=!0,y.value=!1,k.value=!1;try{const n={};s.value&&(n.securityType=s.value);const o=await de(`/securities/search/${encodeURIComponent(a.value.trim())}`,{params:n});_.value=!1,b.value=o,y.value=o.length===0,o.length===1&&await le(`/securities/${o[0].uuid}`)}catch(n){_.value=!1,b.value=[],y.value=!1,k.value=!0,N.value=String(n)}}}function H(n){return n.markets.some(o=>o.firstPriceDate&&o.lastPriceDate)}function L(n){return n.markets.some(o=>o.lastPriceDate&&ge(new Date,new Date(o.lastPriceDate))<30)}function z(n){var o;return[...new Set((o=n.markets)==null?void 0:o.map(x=>x.symbol))].filter(x=>!!x)}return(n,o)=>{const x=g("InputText"),G=_e,E=g("ProgressSpinner"),K=g("Button"),Q=ve,B=g("Message"),C=g("Card"),J=pe,W=g("Tag"),X=fe,M=ue("tooltip");return l(),d("div",we,[u("div",Te,[h(C,null,{title:i(()=>[r(" Security Search ")]),content:i(()=>[u("form",{onSubmit:ce(Y,["prevent"])},[h(Q,null,{default:i(()=>[u("div",xe,[h(x,{id:"searchTermInput",modelValue:f(a),"onUpdate:modelValue":o[0]||(o[0]=c=>$(a)?a.value=c:null),type:"search",class:"w-full",autofocus:""},null,8,["modelValue"]),Se]),h(G,{modelValue:f(s),"onUpdate:modelValue":o[1]||(o[1]=c=>$(s)?s.value=c:null),class:"w-full mt-4"},null,8,["modelValue"]),h(K,{type:"submit",disabled:!f(a)||f(_),class:"w-full flex justify-content-center mt-4"},{default:i(()=>[f(_)?(l(),w(E,{key:1,style:{height:"20px"}})):(l(),d("span",De,"Search"))]),_:1},8,["disabled"])]),_:1}),f(y)?(l(),w(B,{key:0,severity:"info"},{default:i(()=>[r(" Sorry, no results were found. ")]),_:1})):D("",!0),f(k)?(l(),w(B,{key:1,severity:"error"},{default:i(()=>[r(" Sorry, there was an error:"),ke,r(T(f(N)),1)]),_:1})):D("",!0)],32)]),_:1}),f(b).length>0?(l(),w(C,{key:0,class:"mt-4"},{title:i(()=>[r(" Results ")]),content:i(()=>[(l(!0),d(V,null,P(f(b),c=>(l(),d("div",{key:c.uuid,class:"mb-3"},[u("div",qe,[H(c)?j((l(),d("i",{key:0,class:ie(["i-carbon-chart-line mr-1",[{"text-primary":L(c)}]])},null,2)),[[M,"Prices available",void 0,{top:!0}]]):D("",!0),j((l(),w(J,{to:`/securities/${c.uuid}`},{default:i(()=>[r(T(c.name),1)]),_:2},1032,["to"])),[[M,"Drag and drop me to Portfolio Performance!",void 0,{top:!0}]]),h(W,{class:"mx-1 bg-teal-500"},{default:i(()=>[r(T(c.securityType),1)]),_:2},1024),(l(!0),d(V,null,P(c.tags,S=>(l(),w(X,{key:S,name:S},null,8,["name"]))),128))]),u("div",Ce,[r(T(c.isin)+" Â· "+T(c.wkn)+" ",1),(l(!0),d(V,null,P(z(c),(S,Z)=>(l(),d("span",{key:Z}," Â· "+T(S),1))),128))])]))),128))]),_:1})):D("",!0),h(C,{class:"mt-4"},{title:i(()=>[r(" Your contribution is needed ðŸ’ª ")]),content:i(()=>[r(" Your help is needed to keep this website up and running. Have you thought about contributing? You could: "),Ve]),_:1})])])}}});export{Be as default};
