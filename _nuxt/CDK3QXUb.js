import{_ as B}from"./DE0xRdBE.js";import{c as T,e as W,a as x,b as F}from"./DqAICJzB.js";import{u as O}from"./BYdCEuWR.js";import{q as z,a as m,w as L,h as N,c as i,x as a,y as p,u as t,A as f,z as k,W as y,X as c,Y as h,o as n,d as Y,G as R,F as S}from"./B8rbjWwB.js";import{a as w}from"./Cqcw0BMO.js";import{s as q,a as g}from"./CR9hbPOI.js";import{s as E}from"./DQiJn8v6.js";import{s as G}from"./DfyLbjyW.js";import{a as X}from"./BOz3js_G.js";import"./DlAUqK2U.js";import"./D09BqSY3.js";import"./DwOjGboU.js";const j={class:"flex items-end",style:{height:"400px"}},re=z({__name:"weekly",setup(H){const r=m(new Date().getFullYear()),d=m();function $(s){d.value.toggle(s)}const v=m(new Date),_=X(v),{data:u,pending:C,refresh:b}=T(`statsWeeks:${r.value}`,async()=>{const s=await O(`/stats/updates/weeks?year=${r.value}`);for(const e of s)e.firstUpdate&&(e.firstUpdate=new Date(e.firstUpdate)),e.lastUpdate&&(e.lastUpdate=new Date(e.lastUpdate));return v.value=new Date,{weeks:s.sort((e,l)=>e.week-l.week)}});L(r,()=>b());const D=N(()=>{var s,e;return{labels:(s=u.value)==null?void 0:s.weeks.map(l=>l.week),datasets:[{backgroundColor:"#3B82F6",data:(e=u.value)==null?void 0:e.weeks.map(l=>l.count)}]}}),U={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}}};function A(s){S(s)}return(s,e)=>{const l=B;return n(),i("div",null,[a(t(q),null,{default:p(()=>[a(t(w),{label:"Versions",icon:"i-carbon-tag",class:"p-button-secondary",onClick:e[0]||(e[0]=o=>A("/stats"))}),a(t(w),{label:"Weekly",icon:"i-carbon-calendar",class:"p-button-primary",disabled:!0})]),_:1}),f("h2",null,[e[4]||(e[4]=k(" Weekly Statistics for ")),f("a",{class:"cursor-pointer text-blue-500",onClick:$},y(t(r)),1)]),a(t(G),{ref_key:"yearOverlay",ref:d},{default:p(()=>[a(t(w),{icon:"i-carbon-close-large",rounded:"","icon-class":"text-xl",class:"position-absolute top-0 right-0 transform translate-x-1/2 -translate-y-1/2",onClick:e[1]||(e[1]=o=>t(d).hide())}),a(t(W),{modelValue:t(r),"onUpdate:modelValue":e[2]||(e[2]=o=>Y(r)?r.value=o:null),"use-grouping":!1},null,8,["modelValue"])]),_:1},512),t(C)||!t(u)?(n(),i(c,{key:0},[a(t(g),{width:"15em"}),f("div",j,[(n(),i(c,null,h([30,25,45,70,90],(o,V)=>a(t(g),{key:V,width:"20%",height:`${o}%`,class:"mr-2"},null,8,["height"])),64))]),(n(!0),i(c,null,h(Array(10).keys(),o=>(n(),R(t(g),{key:o,class:"mt-4"}))),128))],64)):(n(),i(c,{key:1},[k(" Last updated "+y(t(_))+" ",1),a(l,{small:"",icon:"i-carbon-renew",onClick:e[3]||(e[3]=o=>t(b)())}),a(t(E),{type:"line",data:t(D),options:U,style:{height:"400px"}},null,8,["data"]),a(t(F),{value:t(u).weeks,"sort-field":"week",class:"font-mono",size:"small","sort-order":-1},{default:p(()=>[a(t(x),{field:"week",header:"Week",sortable:!0},{body:p(o=>[k(y(o.data.week),1)]),_:1}),a(t(x),{field:"count",header:"Count",sortable:!0,class:"!text-right"})]),_:1},8,["value"])],64))])}}});export{re as default};
