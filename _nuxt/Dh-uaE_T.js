import{_ as V}from"./CjvjrxlH.js";import{c as B,e as T,a as h,b as W}from"./DArBI39R.js";import{u as F}from"./C0hNp1-n.js";import{q as O,a as m,w as z,h as L,c as i,A as u,x as a,u as e,z as f,W as k,y,X as c,Y as x,o as l,F as N,d as Y,G as R}from"./Cxmcxolx.js";import{a as g}from"./BXG1YoKt.js";import{s as S}from"./uUrycq8p.js";import{s as q}from"./CcfW7djB.js";import{s as w}from"./ymjP7TFr.js";import{a as E}from"./kos67jpE.js";import"./DlAUqK2U.js";import"./ByCZE7bt.js";import"./MMo5Al1e.js";const G={class:"p-buttonset"},X={class:"flex items-end",style:{height:"400px"}},oe=O({__name:"weekly",setup(j){const r=m(new Date().getFullYear()),d=m();function _(s){d.value.toggle(s)}const v=m(new Date),$=E(v),{data:p,pending:C,refresh:b}=B(`statsWeeks:${r.value}`,async()=>{const s=await F(`/stats/updates/weeks?year=${r.value}`);for(const t of s)t.firstUpdate&&(t.firstUpdate=new Date(t.firstUpdate)),t.lastUpdate&&(t.lastUpdate=new Date(t.lastUpdate));return v.value=new Date,{weeks:s.sort((t,n)=>t.week-n.week)}});z(r,()=>b());const D=L(()=>{var s,t;return{labels:(s=p.value)==null?void 0:s.weeks.map(n=>n.week),datasets:[{backgroundColor:"#3B82F6",data:(t=p.value)==null?void 0:t.weeks.map(n=>n.count)}]}}),U={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}}};return(s,t)=>{const n=V;return l(),i("div",null,[u("div",G,[a(e(g),{label:"Versions",icon:"i-carbon-tag",class:"p-button-secondary",onClick:t[0]||(t[0]=o=>("navigateTo"in s?s.navigateTo:e(N))("/stats/"))}),a(e(g),{label:"Weekly",icon:"i-carbon-calendar",class:"p-button-primary",disabled:!0})]),u("h2",null,[f(" Weekly Statistics for "),u("a",{class:"cursor-pointer text-blue-500",onClick:_},k(e(r)),1)]),a(e(q),{ref_key:"yearOverlay",ref:d},{default:y(()=>[a(e(g),{icon:"i-carbon-close-large",rounded:"","icon-class":"text-xl",class:"position-absolute top-0 right-0 transform translate-x-1/2 -translate-y-1/2",onClick:t[1]||(t[1]=o=>e(d).hide())}),a(e(T),{modelValue:e(r),"onUpdate:modelValue":t[2]||(t[2]=o=>Y(r)?r.value=o:null),"use-grouping":!1},null,8,["modelValue"])]),_:1},512),e(C)||!e(p)?(l(),i(c,{key:0},[a(e(w),{width:"15em"}),u("div",X,[(l(),i(c,null,x([30,25,45,70,90],(o,A)=>a(e(w),{key:A,width:"20%",height:`${o}%`,class:"mr-2"},null,8,["height"])),64))]),(l(!0),i(c,null,x(Array(10).keys(),o=>(l(),R(e(w),{key:o,class:"mt-4"}))),128))],64)):(l(),i(c,{key:1},[f(" Last updated "+k(e($))+" ",1),a(n,{small:"",icon:"i-carbon-renew",onClick:t[3]||(t[3]=o=>e(b)())}),a(e(S),{type:"line",data:e(D),options:U,style:{height:"400px"}},null,8,["data"]),a(e(W),{value:e(p).weeks,"sort-field":"week",class:"font-mono",size:"small","sort-order":-1},{default:y(()=>[a(e(h),{field:"week",header:"Week",sortable:!0},{body:y(o=>[f(k(o.data.week),1)]),_:1}),a(e(h),{field:"count",header:"Count",sortable:!0,class:"!text-right"})]),_:1},8,["value"])],64))])}}});export{oe as default};
