import{_ as B}from"./zRhs_WZK.js";import{c as T,e as W,a as h,b as F}from"./D2s_A-2P.js";import{u as O}from"./9oZGsnO1.js";import{q as z,a as m,w as L,h as N,c as i,x as a,y as c,u as e,A as f,z as k,W as y,X as p,Y as x,o as n,d as Y,G as R,F as S}from"./BsvxEGUR.js";import{a as w}from"./llmdR5xp.js";import{s as q,a as g}from"./Co_LqHrr.js";import{s as E}from"./D3Bl7er3.js";import{s as G}from"./D_s3k4um.js";import{b as X}from"./BgczN_N4.js";import"./DlAUqK2U.js";import"./g-hTWYWr.js";const j={class:"flex items-end",style:{height:"400px"}},oe=z({__name:"weekly",setup(H){const r=m(new Date().getFullYear()),d=m();function _(s){d.value.toggle(s)}const v=m(new Date),$=X(v),{data:u,pending:C,refresh:b}=T(`statsWeeks:${r.value}`,async()=>{const s=await O(`/stats/updates/weeks?year=${r.value}`);for(const t of s)t.firstUpdate&&(t.firstUpdate=new Date(t.firstUpdate)),t.lastUpdate&&(t.lastUpdate=new Date(t.lastUpdate));return v.value=new Date,{weeks:s.sort((t,l)=>t.week-l.week)}});L(r,()=>b());const D=N(()=>{var s,t;return{labels:(s=u.value)==null?void 0:s.weeks.map(l=>l.week),datasets:[{backgroundColor:"#3B82F6",data:(t=u.value)==null?void 0:t.weeks.map(l=>l.count)}]}}),U={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}}};function A(s){S(s)}return(s,t)=>{const l=B;return n(),i("div",null,[a(e(q),null,{default:c(()=>[a(e(w),{label:"Versions",icon:"i-carbon-tag",class:"p-button-secondary",onClick:t[0]||(t[0]=o=>A("/stats"))}),a(e(w),{label:"Weekly",icon:"i-carbon-calendar",class:"p-button-primary",disabled:!0})]),_:1}),f("h2",null,[k(" Weekly Statistics for "),f("a",{class:"cursor-pointer text-blue-500",onClick:_},y(e(r)),1)]),a(e(G),{ref_key:"yearOverlay",ref:d},{default:c(()=>[a(e(w),{icon:"i-carbon-close-large",rounded:"","icon-class":"text-xl",class:"position-absolute top-0 right-0 transform translate-x-1/2 -translate-y-1/2",onClick:t[1]||(t[1]=o=>e(d).hide())}),a(e(W),{modelValue:e(r),"onUpdate:modelValue":t[2]||(t[2]=o=>Y(r)?r.value=o:null),"use-grouping":!1},null,8,["modelValue"])]),_:1},512),e(C)||!e(u)?(n(),i(p,{key:0},[a(e(g),{width:"15em"}),f("div",j,[(n(),i(p,null,x([30,25,45,70,90],(o,V)=>a(e(g),{key:V,width:"20%",height:`${o}%`,class:"mr-2"},null,8,["height"])),64))]),(n(!0),i(p,null,x(Array(10).keys(),o=>(n(),R(e(g),{key:o,class:"mt-4"}))),128))],64)):(n(),i(p,{key:1},[k(" Last updated "+y(e($))+" ",1),a(l,{small:"",icon:"i-carbon-renew",onClick:t[3]||(t[3]=o=>e(b)())}),a(e(E),{type:"line",data:e(D),options:U,style:{height:"400px"}},null,8,["data"]),a(e(F),{value:e(u).weeks,"sort-field":"week",class:"font-mono",size:"small","sort-order":-1},{default:c(()=>[a(e(h),{field:"week",header:"Week",sortable:!0},{body:c(o=>[k(y(o.data.week),1)]),_:1}),a(e(h),{field:"count",header:"Count",sortable:!0,class:"!text-right"})]),_:1},8,["value"])],64))])}}});export{oe as default};
