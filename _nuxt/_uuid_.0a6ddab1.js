import{u as _e,_ as ve,a as pe,b as fe}from"./useConfirmDialog.91a7748d.js";import{_ as ye}from"./TextBtn.78a6a4ee.js";import{_ as be}from"./AcceptBtn.vue_vue_type_script_setup_true_lang.14ab60cf.js";import{_ as ke}from"./AddBtn.vue_vue_type_script_setup_true_lang.b8860b00.js";import{d as Ce,u as he,f as xe,g as J,h as we,i as p,j as O,o as _,c as b,b as o,t as s,a as e,w as l,r as d,k as S,e as m,F as R,l as z,m as H,n as T,p as K,q as x}from"./entry.8c8e0735.js";import{u as Q}from"./asyncData.ff30a269.js";import"./_plugin-vue_export-helper.a1a6add7.js";const ge=m(" UUID: "),Se=m(" ISIN: "),Te=m(" WKN: "),Ue={key:0},Ve=m(" Symbol (Frankfurt): "),$e={key:1},De=m(" Symbol (NASDAQ): "),Ne={key:2},Pe=m(" Symbol (New York): "),Me=m(" Type: "),Ae=["onSubmit"],Be={class:"p-float-label mt-4"},Fe=o("label",{for:"marketCode"},"Market code (MIC)",-1),Ie={class:"p-float-label mt-4"},Xe=o("label",{for:"currencyCode"},"Currency code",-1),We={class:"p-float-label mt-4"},Ee=o("label",{for:"symbol"},"Symbol",-1),Le={class:"field-checkbox mt-4"},je=o("label",{for:"updatePrices"},"Update prices",-1),qe=["onSubmit"],Je={class:"flex"},Oe={class:"flex-grow-1 flex"},et=Ce({__name:"[uuid]",async setup(Re){let v,w;he({title:"Portfolio Report Admin"});const M=xe(),Y=_e(),{data:A,refresh:U,error:G}=([v,w]=J(()=>Q(`security:${M.params.uuid}`,()=>x(`/securities/${M.params.uuid}`))),v=await v,w(),v),{data:B}=([v,w]=J(()=>Q(()=>x("/taxonomies/"),"$75z8gqmFrj")),v=await v,w(),v);if(G.value||!A.value||!B.value)throw we({statusCode:404,message:"This page could not be found",fatal:!0});const n=p(A.value),V=p(B.value),k=p(!1),i=p({marketCode:"",currencyCode:"",symbol:"",updatePrices:!1}),g=p(!1),h=p(!1),$=p(""),f=p([]),D=O(()=>f.value.reduce((r,a)=>r+Number(a.weight),0)),F=O(()=>n.value.securityTaxonomies.map(r=>({...r,taxonomy:V.value.find(a=>a.uuid===r.taxonomyUuid)})));function Z(){i.value={marketCode:"",currencyCode:"",symbol:"",updatePrices:!0},g.value=!0,k.value=!0}function ee(r){i.value={...r},g.value=!1,k.value=!0}async function te(){await x(`/securities/uuid/${n.value.uuid}/markets/${i.value.marketCode}`,{method:"post",body:i.value}),U(),k.value=!1}async function oe(r){await Y({message:`Are you sure you want to delete the market "${r.marketCode}"?`,header:"Delete market"})&&(await x(`/securities/uuid/${n.value.uuid}/markets/${r.marketCode}`,{method:"delete"}),U())}function ae(r){$.value=r.uuid;const a=F.value.filter(N=>{var C;return((C=N.taxonomy)==null?void 0:C.rootUuid)===r.uuid});f.value=JSON.parse(JSON.stringify(a)),h.value=!0}async function le(){await x(`/securities/uuid/${n.value.uuid}/taxonomies/${$.value}`,{method:"put",body:f.value}),U(),h.value=!1}return(r,a)=>{const N=d("Chip"),C=d("TabPanel"),c=d("Column"),I=ve,X=pe,W=d("DataTable"),ne=ye,ue=d("Card"),se=d("TabView"),P=d("InputText"),ie=d("Checkbox"),E=fe,L=be,j=d("Dialog"),re=d("InputNumber"),de=d("Dropdown"),me=d("Message"),ce=ke;return _(),b("div",null,[o("h2",null,"Security: "+s(n.value.name),1),e(se,null,{default:l(()=>[e(C,{header:"Master data"},{default:l(()=>[o("ul",null,[o("li",null,[ge,o("b",null,s(n.value.uuid),1)]),o("li",null,[Se,o("b",null,s(n.value.isin),1)]),o("li",null,[Te,o("b",null,s(n.value.wkn),1)]),n.value.symbolXfra?(_(),b("li",Ue,[Ve,o("b",null,s(n.value.symbolXfra),1)])):S("",!0),n.value.symbolXnas?(_(),b("li",$e,[De,o("b",null,s(n.value.symbolXnas),1)])):S("",!0),n.value.symbolXnys?(_(),b("li",Ne,[Pe,o("b",null,s(n.value.symbolXnys),1)])):S("",!0),o("li",null,[Me,e(N,{class:"mx-1 text-sm bg-teal-500 text-white"},{default:l(()=>[m(s(n.value.securityType),1)]),_:1})])])]),_:1}),e(C,{header:"Markets"},{default:l(()=>[e(W,{value:n.value.markets,headers:[{text:"Market",value:"marketCode"},{text:"Currency",value:"currencyCode"},{text:"Symbol",value:"symbol"},{text:"First price",value:"firstPriceDate"},{text:"Last price",value:"lastPriceDate"},{text:"Update",value:"updatePrices"},{value:"actions"}]},{default:l(()=>[e(c,{field:"marketCode",header:"Market"}),e(c,{field:"currencyCode",header:"Currency"}),e(c,{field:"symbol",header:"Symbol"}),e(c,{field:"firstPriceDate",header:"First Price"}),e(c,{field:"lastPriceDate",header:"Last Price"}),e(c,{field:"updatePrices",header:"Update"}),e(c,null,{body:l(({data:t})=>[e(I,{onClick:u=>ee(t)},null,8,["onClick"]),e(X,{onClick:u=>oe(t)},null,8,["onClick"])]),_:1})]),_:1},8,["value"]),e(ne,{class:"mt-2",icon:"i-carbon-add ",label:"Add market",solid:"",onClick:Z})]),_:1}),e(C,{header:"Taxonomies"},{default:l(()=>[(_(!0),b(R,null,z(V.value.filter(t=>t.parentUuid===null),t=>(_(),H(ue,{key:t.uuid},{title:l(()=>[m(s(t.name)+" ",1),e(I,{onClick:u=>ae(t)},null,8,["onClick"])]),subtitle:l(()=>[m(s(t.uuid),1)]),content:l(()=>[o("ul",null,[(_(!0),b(R,null,z(T(F).filter(u=>{var y;return((y=u.taxonomy)==null?void 0:y.rootUuid)===t.uuid}),u=>{var y,q;return _(),b("li",{key:u.taxonomyUuid},s(u.weight)+"% "+s((y=u.taxonomy)==null?void 0:y.name)+" "+s((q=u.taxonomy)==null?void 0:q.code),1)}),128))])]),_:2},1024))),128))]),_:1})]),_:1}),e(j,{visible:k.value,"onUpdate:visible":a[5]||(a[5]=t=>k.value=t),style:{width:"500px"},header:g.value?"New market":i.value.marketCode,modal:!0},{footer:l(()=>[e(E,{label:"Cancel",onClick:a[4]||(a[4]=t=>k.value=!1)}),e(L,{type:"submit",form:"marketForm",label:"Save"})]),default:l(()=>[o("form",{id:"marketForm",onSubmit:K(te,["prevent"])},[o("div",Be,[e(P,{id:"marketCode",modelValue:i.value.marketCode,"onUpdate:modelValue":a[0]||(a[0]=t=>i.value.marketCode=t),readonly:!g.value,class:"w-full"},null,8,["modelValue","readonly"]),Fe]),o("div",Ie,[e(P,{id:"currencyCode",modelValue:i.value.currencyCode,"onUpdate:modelValue":a[1]||(a[1]=t=>i.value.currencyCode=t),class:"w-full"},null,8,["modelValue"]),Xe]),o("div",We,[e(P,{id:"symbol",modelValue:i.value.symbol,"onUpdate:modelValue":a[2]||(a[2]=t=>i.value.symbol=t),class:"w-full"},null,8,["modelValue"]),Ee]),o("div",Le,[e(ie,{modelValue:i.value.updatePrices,"onUpdate:modelValue":a[3]||(a[3]=t=>i.value.updatePrices=t),"input-id":"updatePrices",binary:!0},null,8,["modelValue"]),je])],40,Ae)]),_:1},8,["visible","header"]),e(j,{visible:h.value,"onUpdate:visible":a[8]||(a[8]=t=>h.value=t),style:{width:"500px"},modal:!0},{footer:l(()=>[o("div",Je,[o("div",Oe,[e(ce,{label:"Add",onClick:a[6]||(a[6]=t=>f.value.push({taxonomyUuid:null,weight:String(100-T(D))}))})]),e(E,{label:"Cancel",onClick:a[7]||(a[7]=t=>h.value=!1)}),e(L,{type:"submit",form:"editTaxonomyForm",label:"Save"})])]),default:l(()=>[o("form",{id:"editTaxonomyForm",onSubmit:K(le,["prevent"])},[e(W,{value:f.value,class:"p-datatable-sm","responsive-layout":"scroll"},{default:l(()=>[e(c,{field:"weight",header:"Weight"},{body:l(({data:t})=>[e(re,{"model-value":Number(t.weight),suffix:"%",min:0,max:100,"onUpdate:modelValue":u=>t.weight=String(u)},null,8,["model-value","onUpdate:modelValue"])]),_:1}),e(c,{field:"taxonomy.name",header:"Name"},{body:l(({data:t})=>[e(de,{modelValue:t.taxonomyUuid,"onUpdate:modelValue":u=>t.taxonomyUuid=u,"option-label":"name","option-value":"uuid",options:V.value.filter(u=>u.rootUuid===$.value)},null,8,["modelValue","onUpdate:modelValue","options"])]),_:1}),e(c,null,{body:l(({data:t})=>[e(X,{onClick:u=>f.value=f.value.filter(y=>y!==t)},null,8,["onClick"])]),_:1})]),_:1},8,["value"]),T(D)!==100?(_(),H(me,{key:0,severity:"warn"},{default:l(()=>[m(" Weights don't sum up to 100%, but: "+s(T(D))+"% ",1)]),_:1})):S("",!0)],40,qe)]),_:1},8,["visible"])])}}});export{et as default};
