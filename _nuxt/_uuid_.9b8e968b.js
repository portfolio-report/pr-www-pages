import{_ as ve}from"./IconLink.3c95c682.js";import{u as pe,_ as fe,a as ye,b as be}from"./useConfirmDialog.42caa1cb.js";import{_ as ke}from"./TextBtn.27ae0b4e.js";import{_ as Ce}from"./AcceptBtn.vue_vue_type_script_setup_true_lang.cdf2e103.js";import{_ as he}from"./AddBtn.vue_vue_type_script_setup_true_lang.b837e99f.js";import{d as xe,u as we,f as ge,g as O,h as Se,i as p,j as R,o as _,c as b,b as o,e as m,t as s,a as e,w as l,r as d,k as S,F as z,l as H,m as K,n as T,p as Q,q as h}from"./entry.abfb84f2.js";import{u as Y}from"./asyncData.17c05b59.js";import"./_plugin-vue_export-helper.a1a6add7.js";const Te=m(" UUID: "),Ue=m(" ISIN: "),Ve=m(" WKN: "),$e={key:0},De=m(" Symbol (Frankfurt): "),Ne={key:1},Pe=m(" Symbol (NASDAQ): "),Me={key:2},Ae=m(" Symbol (New York): "),Be=m(" Type: "),Fe=["onSubmit"],Ie={class:"p-float-label mt-4"},Xe=o("label",{for:"marketCode"},"Market code (MIC)",-1),Le={class:"p-float-label mt-4"},We=o("label",{for:"currencyCode"},"Currency code",-1),Ee={class:"p-float-label mt-4"},je=o("label",{for:"symbol"},"Symbol",-1),qe={class:"field-checkbox mt-4"},Je=o("label",{for:"updatePrices"},"Update prices",-1),Oe=["onSubmit"],Re={class:"flex"},ze={class:"flex-grow-1 flex"},at=xe({__name:"[uuid]",async setup(He){let v,x;we({title:"Portfolio Report Admin"});const A=ge(),G=pe(),{data:B,refresh:U,error:Z}=([v,x]=O(()=>Y(`security:${A.params.uuid}`,()=>h(`/securities/${A.params.uuid}`))),v=await v,x(),v),{data:F}=([v,x]=O(()=>Y(()=>h("/taxonomies/"),"$75z8gqmFrj")),v=await v,x(),v);if(Z.value||!B.value||!F.value)throw Se({statusCode:404,message:"This page could not be found",fatal:!0});const n=p(B.value),V=p(F.value),k=p(!1),i=p({marketCode:"",currencyCode:"",symbol:"",updatePrices:!1}),w=p(!1),C=p(!1),$=p(""),f=p([]),D=R(()=>f.value.reduce((r,a)=>r+Number(a.weight),0)),I=R(()=>n.value.securityTaxonomies.map(r=>({...r,taxonomy:V.value.find(a=>a.uuid===r.taxonomyUuid)})));function ee(){i.value={marketCode:"",currencyCode:"",symbol:"",updatePrices:!0},w.value=!0,k.value=!0}function te(r){i.value={...r},w.value=!1,k.value=!0}async function oe(){await h(`/securities/uuid/${n.value.uuid}/markets/${i.value.marketCode}`,{method:"post",body:i.value}),U(),k.value=!1}async function ae(r){await G({message:`Are you sure you want to delete the market "${r.marketCode}"?`,header:"Delete market"})&&(await h(`/securities/uuid/${n.value.uuid}/markets/${r.marketCode}`,{method:"delete"}),U())}function le(r){$.value=r.uuid;const a=I.value.filter(N=>{var g;return((g=N.taxonomy)==null?void 0:g.rootUuid)===r.uuid});f.value=JSON.parse(JSON.stringify(a)),C.value=!0}async function ne(){await h(`/securities/uuid/${n.value.uuid}/taxonomies/${$.value}`,{method:"put",body:f.value}),U(),C.value=!1}return(r,a)=>{const N=ve,g=d("Chip"),P=d("TabPanel"),c=d("Column"),X=fe,L=ye,W=d("DataTable"),ue=ke,se=d("Card"),ie=d("TabView"),M=d("InputText"),re=d("Checkbox"),E=be,j=Ce,q=d("Dialog"),de=d("InputNumber"),me=d("Dropdown"),ce=d("Message"),_e=he;return _(),b("div",null,[o("h2",null,[m(" Security: "+s(n.value.name)+" ",1),e(N,{icon:"i-carbon-earth-europe-africa",to:`/securities/${n.value.uuid}`},null,8,["to"])]),e(ie,null,{default:l(()=>[e(P,{header:"Master data"},{default:l(()=>[o("ul",null,[o("li",null,[Te,o("b",null,s(n.value.uuid),1)]),o("li",null,[Ue,o("b",null,s(n.value.isin),1)]),o("li",null,[Ve,o("b",null,s(n.value.wkn),1)]),n.value.symbolXfra?(_(),b("li",$e,[De,o("b",null,s(n.value.symbolXfra),1)])):S("",!0),n.value.symbolXnas?(_(),b("li",Ne,[Pe,o("b",null,s(n.value.symbolXnas),1)])):S("",!0),n.value.symbolXnys?(_(),b("li",Me,[Ae,o("b",null,s(n.value.symbolXnys),1)])):S("",!0),o("li",null,[Be,e(g,{class:"mx-1 text-sm bg-teal-500 text-white"},{default:l(()=>[m(s(n.value.securityType),1)]),_:1})])])]),_:1}),e(P,{header:"Markets"},{default:l(()=>[e(W,{value:n.value.markets,headers:[{text:"Market",value:"marketCode"},{text:"Currency",value:"currencyCode"},{text:"Symbol",value:"symbol"},{text:"First price",value:"firstPriceDate"},{text:"Last price",value:"lastPriceDate"},{text:"Update",value:"updatePrices"},{value:"actions"}]},{default:l(()=>[e(c,{field:"marketCode",header:"Market"}),e(c,{field:"currencyCode",header:"Currency"}),e(c,{field:"symbol",header:"Symbol"}),e(c,{field:"firstPriceDate",header:"First Price"}),e(c,{field:"lastPriceDate",header:"Last Price"}),e(c,{field:"updatePrices",header:"Update"}),e(c,null,{body:l(({data:t})=>[e(X,{onClick:u=>te(t)},null,8,["onClick"]),e(L,{onClick:u=>ae(t)},null,8,["onClick"])]),_:1})]),_:1},8,["value"]),e(ue,{class:"mt-2",icon:"i-carbon-add ",label:"Add market",solid:"",onClick:ee})]),_:1}),e(P,{header:"Taxonomies"},{default:l(()=>[(_(!0),b(z,null,H(V.value.filter(t=>t.parentUuid===null),t=>(_(),K(se,{key:t.uuid},{title:l(()=>[m(s(t.name)+" ",1),e(X,{onClick:u=>le(t)},null,8,["onClick"])]),subtitle:l(()=>[m(s(t.uuid),1)]),content:l(()=>[o("ul",null,[(_(!0),b(z,null,H(T(I).filter(u=>{var y;return((y=u.taxonomy)==null?void 0:y.rootUuid)===t.uuid}),u=>{var y,J;return _(),b("li",{key:u.taxonomyUuid},s(u.weight)+"% "+s((y=u.taxonomy)==null?void 0:y.name)+" "+s((J=u.taxonomy)==null?void 0:J.code),1)}),128))])]),_:2},1024))),128))]),_:1})]),_:1}),e(q,{visible:k.value,"onUpdate:visible":a[5]||(a[5]=t=>k.value=t),style:{width:"500px"},header:w.value?"New market":i.value.marketCode,modal:!0},{footer:l(()=>[e(E,{label:"Cancel",onClick:a[4]||(a[4]=t=>k.value=!1)}),e(j,{type:"submit",form:"marketForm",label:"Save"})]),default:l(()=>[o("form",{id:"marketForm",onSubmit:Q(oe,["prevent"])},[o("div",Ie,[e(M,{id:"marketCode",modelValue:i.value.marketCode,"onUpdate:modelValue":a[0]||(a[0]=t=>i.value.marketCode=t),readonly:!w.value,class:"w-full"},null,8,["modelValue","readonly"]),Xe]),o("div",Le,[e(M,{id:"currencyCode",modelValue:i.value.currencyCode,"onUpdate:modelValue":a[1]||(a[1]=t=>i.value.currencyCode=t),class:"w-full"},null,8,["modelValue"]),We]),o("div",Ee,[e(M,{id:"symbol",modelValue:i.value.symbol,"onUpdate:modelValue":a[2]||(a[2]=t=>i.value.symbol=t),class:"w-full"},null,8,["modelValue"]),je]),o("div",qe,[e(re,{modelValue:i.value.updatePrices,"onUpdate:modelValue":a[3]||(a[3]=t=>i.value.updatePrices=t),"input-id":"updatePrices",binary:!0},null,8,["modelValue"]),Je])],40,Fe)]),_:1},8,["visible","header"]),e(q,{visible:C.value,"onUpdate:visible":a[8]||(a[8]=t=>C.value=t),style:{width:"500px"},modal:!0},{footer:l(()=>[o("div",Re,[o("div",ze,[e(_e,{label:"Add",onClick:a[6]||(a[6]=t=>f.value.push({taxonomyUuid:null,weight:String(100-T(D))}))})]),e(E,{label:"Cancel",onClick:a[7]||(a[7]=t=>C.value=!1)}),e(j,{type:"submit",form:"editTaxonomyForm",label:"Save"})])]),default:l(()=>[o("form",{id:"editTaxonomyForm",onSubmit:Q(ne,["prevent"])},[e(W,{value:f.value,class:"p-datatable-sm","responsive-layout":"scroll"},{default:l(()=>[e(c,{field:"weight",header:"Weight"},{body:l(({data:t})=>[e(de,{"model-value":Number(t.weight),suffix:"%",min:0,max:100,"onUpdate:modelValue":u=>t.weight=String(u)},null,8,["model-value","onUpdate:modelValue"])]),_:1}),e(c,{field:"taxonomy.name",header:"Name"},{body:l(({data:t})=>[e(me,{modelValue:t.taxonomyUuid,"onUpdate:modelValue":u=>t.taxonomyUuid=u,"option-label":"name","option-value":"uuid",options:V.value.filter(u=>u.rootUuid===$.value)},null,8,["modelValue","onUpdate:modelValue","options"])]),_:1}),e(c,null,{body:l(({data:t})=>[e(L,{onClick:u=>f.value=f.value.filter(y=>y!==t)},null,8,["onClick"])]),_:1})]),_:1},8,["value"]),T(D)!==100?(_(),K(ce,{key:0,severity:"warn"},{default:l(()=>[m(" Weights don't sum up to 100%, but: "+s(T(D))+"% ",1)]),_:1})):S("",!0)],40,Oe)]),_:1},8,["visible"])])}}});export{at as default};
