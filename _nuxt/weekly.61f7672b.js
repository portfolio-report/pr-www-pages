import{_ as W}from"./TextBtn.a6e0d151.js";import{d as $,h as k,j as F,n as L,c,b as p,a as t,f as s,e as f,t as _,w as y,J as d,K as h,r,o as i,E,k as I,B as P}from"./entry.75906504.js";import{a as R}from"./asyncData.012eb437.js";import{u as Y}from"./useApi.d42deeec.js";import{u as j}from"./index.9bc1bc91.js";import"./_plugin-vue_export-helper.a1a6add7.js";const z={class:"p-buttonset"},J={class:"flex align-items-end",style:{height:"400px"}},Z=$({__name:"weekly",setup(K){const l=k(new Date().getFullYear());F(l,()=>v());const w=k(),C=o=>{w.value.toggle(o)},g=k(new Date),x=j(g),{data:u,pending:D,refresh:v}=R(`statsWeeks:${l.value}`,async()=>{const o=await Y(`/stats/updates/weeks?year=${l.value}`);for(const e of o)e.firstUpdate&&(e.firstUpdate=new Date(e.firstUpdate)),e.lastUpdate&&(e.lastUpdate=new Date(e.lastUpdate));return g.value=new Date,{weeks:o.sort((e,n)=>e.week-n.week)}}),B=L(()=>{var o,e;return{labels:(o=u.value)==null?void 0:o.weeks.map(n=>n.week),datasets:[{backgroundColor:"#3B82F6",data:(e=u.value)==null?void 0:e.weeks.map(n=>n.count)}]}}),U={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}}};return(o,e)=>{const n=r("Button"),V=r("InputNumber"),A=r("OverlayPanel"),m=r("Skeleton"),O=W,T=r("Chart"),b=r("Column"),N=r("DataTable");return i(),c("div",null,[p("div",z,[t(n,{label:"Versions",icon:"i-carbon-tag",class:"p-button-secondary",onClick:e[0]||(e[0]=a=>s(E)("/stats/"))}),t(n,{label:"Weekly",icon:"i-carbon-calendar",class:"p-button-primary",disabled:!0})]),p("h2",null,[f(" Weekly Statistics for "),p("a",{class:"cursor-pointer",onClick:C},_(s(l)),1)]),t(A,{ref_key:"yearOverlay",ref:w,"show-close-icon":!0},{default:y(()=>[t(V,{modelValue:s(l),"onUpdate:modelValue":e[1]||(e[1]=a=>I(l)?l.value=a:null),"use-grouping":!1},null,8,["modelValue"])]),_:1},512),s(D)||!s(u)?(i(),c(d,{key:0},[t(m,{width:"15em"}),p("div",J,[(i(),c(d,null,h([30,25,45,70,90],(a,S)=>t(m,{key:S,width:"20%",height:a+"%",class:"mr-2"},null,8,["height"])),64))]),(i(!0),c(d,null,h(Array(10).keys(),a=>(i(),P(m,{key:a,class:"mt-4"}))),128))],64)):(i(),c(d,{key:1},[f(" Last updated "+_(s(x))+" ",1),t(O,{small:"",icon:"i-carbon-renew",onClick:e[2]||(e[2]=a=>s(v)())}),t(T,{type:"line",data:s(B),options:U,style:{height:"400px"}},null,8,["data"]),t(N,{value:s(u).weeks,"sort-field":"week",class:"p-datatable-sm","sort-order":-1},{default:y(()=>[t(b,{field:"week",header:"Week",sortable:!0},{body:y(a=>[f(_(a.data.week),1)]),_:1}),t(b,{field:"count",header:"Count",sortable:!0,class:"text-right"})]),_:1},8,["value"])],64))])}}});export{Z as default};
