import{d as Y,r as _,o as a,c as m,a as h,b as r,u as Z,F as ee,G as te,h as y,j as oe,w as p,f,B as b,H as D,I as ne,e as s,A as se,k as M,t as g,J as V,K as C,L,z as ae,_ as re}from"./entry.b67fc64e.js";import{_ as le}from"./SecurityTag.013683f1.js";import{u as ue}from"./useApi.03b0f710.js";import"./_plugin-vue_export-helper.a1a6add7.js";const ie={class:"p-float-label"},ce=r("label",{for:"dropdown"},"Security Type",-1),pe=Y({__name:"SelectSecurityType",props:{modelValue:null},emits:["update:modelValue"],setup(e,{emit:t}){const u=[{text:"*",value:""},{text:"share",value:"share"},{text:"fund",value:"fund"},{text:"bond",value:"bond"},{text:"index",value:"index"}];function i(c){t("update:modelValue",c)}return(c,d)=>{const v=_("Dropdown");return a(),m("span",ie,[h(v,{id:"dropdown",class:"w-full","model-value":e.modelValue,options:u,"option-label":"text","option-value":"value","show-clear":!0,"onUpdate:modelValue":i},null,8,["model-value"]),ce])}}});function N(e,t){if(t.length<e)throw new TypeError(e+" argument"+(e>1?"s":"")+" required, but only "+t.length+" present")}function T(e){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?T=function(u){return typeof u}:T=function(u){return u&&typeof Symbol=="function"&&u.constructor===Symbol&&u!==Symbol.prototype?"symbol":typeof u},T(e)}function fe(e){N(1,arguments);var t=Object.prototype.toString.call(e);return e instanceof Date||T(e)==="object"&&t==="[object Date]"?new Date(e.getTime()):typeof e=="number"||t==="[object Number]"?new Date(e):((typeof e=="string"||t==="[object String]")&&typeof console<"u"&&(console.warn("Starting with v2.0.0-beta.1 date-fns doesn't accept strings as date arguments. Please use `parseISO` to parse strings. See: https://github.com/date-fns/date-fns/blob/master/docs/upgradeGuide.md#string-arguments"),console.warn(new Error().stack)),new Date(NaN))}function O(e){var t=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()));return t.setUTCFullYear(e.getFullYear()),e.getTime()-t.getTime()}function U(e){N(1,arguments);var t=fe(e);return t.setHours(0,0,0,0),t}var me=864e5;function de(e,t){N(2,arguments);var u=U(e),i=U(t),c=u.getTime()-O(u),d=i.getTime()-O(i);return Math.round((c-d)/me)}const ye={class:"flex justify-content-center"},_e={style:{width:"800px"}},he=["onSubmit"],ve={class:"p-float-label mt-2"},be=r("label",{for:"searchTermInput"},"ISIN/WKN/Symbol/Name",-1),ge={key:0,class:"font-bold"},we=r("br",null,null,-1),Se={class:"text-lg font-medium flex align-items-center"},xe={class:"text-600"},De=r("ul",null,[r("li",null,[s(" Actively maintain and develop the "),r("a",{href:"https://www.github.com/portfolio-report"},"source code on Github"),s(". ")]),r("li",null,[s(" Become member of the "),r("a",{href:"https://forum.portfolio-performance.info"},"forum"),s(" and help other users. ")]),r("li",null,[s(" Cover monthly costs for server operation and licence fees. Become sponsor on "),r("a",{href:"https://github.com/sponsors/tfabritius"},"Github"),s(". ")])],-1),Ve=Y({__name:"search",setup(e){Z({title:"Portfolio Report Search"});const t=ee(),u=te(),i=y(""),c=y(""),d=y([]),v=y(!1),w=y(!1),k=y(!1),B=y("");R(),I(),oe(()=>t.query.q,()=>{t.query.q&&(R(),I())});async function F(){j(),await I()}function R(){i.value=t.query.q,c.value=t.query.securityType||""}function j(){const o={q:i.value};c.value&&(o.securityType=c.value),u.push({path:t.path,query:o})}async function I(){if(!!i.value){w.value=!0,v.value=!1,k.value=!1;try{const o={};c.value&&(o.securityType=c.value);const n=await ue(`/securities/search/${encodeURIComponent(i.value.trim())}`,{params:o});w.value=!1,d.value=n,v.value=n.length===0}catch(o){w.value=!1,d.value=[],v.value=!1,k.value=!0,B.value=String(o)}}}function H(o){return o.markets.some(n=>n.firstPriceDate&&n.lastPriceDate)}function E(o){return o.markets.some(n=>n.lastPriceDate&&de(new Date,new Date(n.lastPriceDate))<30)}function G(o){var n;return[...new Set([o.symbolXfra,o.symbolXnas,o.symbolXnys,...(n=o.markets)==null?void 0:n.map(S=>S.symbol)])].filter(S=>!!S)}return(o,n)=>{const S=_("InputText"),$=pe,z=_("ProgressSpinner"),X=_("Button"),q=_("Message"),P=_("Card"),K=re,Q=_("Tag"),J=le,A=ne("tooltip");return a(),m("div",ye,[r("div",_e,[h(P,null,{title:p(()=>[s("Security Search")]),content:p(()=>[r("form",{onSubmit:se(F,["prevent"])},[r("div",ve,[h(S,{id:"searchTermInput",modelValue:f(i),"onUpdate:modelValue":n[0]||(n[0]=l=>M(i)?i.value=l:null),type:"search",class:"w-full",autofocus:""},null,8,["modelValue"]),be]),h($,{modelValue:f(c),"onUpdate:modelValue":n[1]||(n[1]=l=>M(c)?c.value=l:null),class:"w-full mt-4"},null,8,["modelValue"]),h(X,{type:"submit",disabled:!f(i)||f(w),class:"w-full flex justify-content-center mt-4"},{default:p(()=>[f(w)?(a(),b(z,{key:1,style:{height:"20px"}})):(a(),m("span",ge,"Search"))]),_:1},8,["disabled"]),f(v)?(a(),b(q,{key:0,severity:"info"},{default:p(()=>[s(" Sorry, no results were found. ")]),_:1})):D("",!0),f(k)?(a(),b(q,{key:1,severity:"error"},{default:p(()=>[s(" Sorry, there was an error:"),we,s(g(f(B)),1)]),_:1})):D("",!0)],40,he)]),_:1}),f(d).length>0?(a(),b(P,{key:0,class:"mt-4"},{title:p(()=>[s("Results")]),content:p(()=>[(a(!0),m(V,null,C(f(d),l=>(a(),m("div",{key:l.uuid,class:"mb-3"},[r("div",Se,[H(l)?L((a(),m("i",{key:0,class:ae(["i-carbon-chart-line","mr-1",{"text-primary":E(l)}])},null,2)),[[A,"Prices available",void 0,{top:!0}]]):D("",!0),L((a(),b(K,{to:"/securities/"+l.uuid},{default:p(()=>[s(g(l.name),1)]),_:2},1032,["to"])),[[A,"Drag and drop me to Portfolio Performance!",void 0,{top:!0}]]),h(Q,{class:"mx-1 bg-teal-500"},{default:p(()=>[s(g(l.securityType),1)]),_:2},1024),(a(!0),m(V,null,C(l.tags,x=>(a(),b(J,{key:x,name:x},null,8,["name"]))),128))]),r("div",xe,[s(g(l.isin)+" \xB7 "+g(l.wkn)+" ",1),(a(!0),m(V,null,C(G(l),(x,W)=>(a(),m("span",{key:W}," \xB7 "+g(x),1))),128))])]))),128))]),_:1})):D("",!0),h(P,{class:"mt-4"},{title:p(()=>[s("Your contribution is needed \u{1F4AA}")]),content:p(()=>[s(" Your help is needed to keep this website up and running. Have you thought about contributing? You could: "),De]),_:1})])])}}});export{Ve as default};
