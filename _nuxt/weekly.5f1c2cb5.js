import{d as S,h as k,j as W,n as $,o as c,c as i,b as d,a as t,f as l,t as f,w as y,I as p,J as b,e as _,r as o,C as I,F as L}from"./entry.49bc9768.js";import{a as P}from"./asyncData.3ae7452f.js";import{u as Y}from"./useApi.15294794.js";import{u as j}from"./index.8517c8c9.js";const z={class:"p-buttonset"},E=_(" Weekly Statistics for "),J={class:"flex align-items-end",style:{height:"400px"}},M=S({__name:"weekly",setup(R){const r=k(new Date().getFullYear());W(r,()=>g());const w=k(),C=s=>{w.value.toggle(s)},v=k(new Date),x=j(v),{data:u,pending:D,refresh:g}=P(`statsWeeks:${r.value}`,async()=>{const s=await Y(`/stats/updates/weeks?year=${r.value}`);for(const e of s)e.firstUpdate&&(e.firstUpdate=new Date(e.firstUpdate)),e.lastUpdate&&(e.lastUpdate=new Date(e.lastUpdate));return v.value=new Date,{weeks:s.sort((e,n)=>e.week-n.week)}}),B=$(()=>{var s,e;return{labels:(s=u.value)==null?void 0:s.weeks.map(n=>n.week),datasets:[{backgroundColor:"#3B82F6",data:(e=u.value)==null?void 0:e.weeks.map(n=>n.count)}]}}),U={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}}};return(s,e)=>{const n=o("Button"),T=o("InputNumber"),V=o("OverlayPanel"),m=o("Skeleton"),A=o("TextBtn"),O=o("Chart"),h=o("Column"),N=o("DataTable");return c(),i("div",null,[d("div",z,[t(n,{label:"Versions",icon:"i-carbon-tag",class:"p-button-secondary",onClick:e[0]||(e[0]=a=>l(I)("/stats/"))}),t(n,{label:"Weekly",icon:"i-carbon-calendar",class:"p-button-primary",disabled:!0})]),d("h2",null,[E,d("a",{class:"cursor-pointer",onClick:C},f(r.value),1)]),t(V,{ref_key:"yearOverlay",ref:w,"show-close-icon":!0},{default:y(()=>[t(T,{modelValue:r.value,"onUpdate:modelValue":e[1]||(e[1]=a=>r.value=a),"use-grouping":!1},null,8,["modelValue"])]),_:1},512),l(D)||!l(u)?(c(),i(p,{key:0},[t(m,{width:"15em"}),d("div",J,[(c(),i(p,null,b([30,25,45,70,90],(a,F)=>t(m,{key:F,width:"20%",height:a+"%",class:"mr-2"},null,8,["height"])),64))]),(c(!0),i(p,null,b(Array(10).keys(),a=>(c(),L(m,{key:a,class:"mt-4"}))),128))],64)):(c(),i(p,{key:1},[_(" Last updated "+f(l(x))+" ",1),t(A,{small:"",icon:"i-carbon-renew",onClick:e[2]||(e[2]=a=>l(g)())}),t(O,{type:"line",data:l(B),options:U,style:{height:"400px"}},null,8,["data"]),t(N,{value:l(u).weeks,"sort-field":"week",class:"p-datatable-sm","sort-order":-1},{default:y(()=>[t(h,{field:"week",header:"Week",sortable:!0},{body:y(a=>[_(f(a.data.week),1)]),_:1}),t(h,{field:"count",header:"Count",sortable:!0,class:"text-right"})]),_:1},8,["value"])],64))])}}});export{M as default};
