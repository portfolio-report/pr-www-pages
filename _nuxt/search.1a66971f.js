import{h as I,l as g,t as l,m as f,q as h,x as u,r as v,B as Z,C as ee,D as te,c as oe,j as ne,w as ae,E as se,s as i,u as p,F as T,G as S,v as r,z as re,i as j,H as w,I as V,J as P,K as U,y as le,_ as ue}from"./entry.2ffa69f7.js";import{_ as ce}from"./SecurityTag.e7a63dfc.js";import{u as ie}from"./useApi.c637d6d4.js";import"./_plugin-vue_export-helper.c27b6911.js";const pe={class:"p-float-label"},fe=u("label",null,"Security Type",-1),me=I({__name:"SelectSecurityType",props:{modelValue:{}},emits:["update:modelValue"],setup(t,{emit:e}){const d=e,m=[{text:"*",value:""},{text:"share",value:"share"},{text:"fund",value:"fund"},{text:"bond",value:"bond"},{text:"index",value:"index"}];function n(a){d("update:modelValue",a)}return(a,b)=>{const _=g("Dropdown");return l(),f("span",pe,[h(_,{class:"w-full","model-value":a.modelValue,options:m,"option-label":"text","option-value":"value","show-clear":!0,"onUpdate:modelValue":n},null,8,["model-value"]),fe])}}}),de=I({name:"ClientOnly",inheritAttrs:!1,props:["fallback","placeholder","placeholderTag","fallbackTag"],setup(t,{slots:e,attrs:d}){const m=v(!1);return Z(()=>{m.value=!0}),n=>{var y;if(m.value)return(y=e.default)==null?void 0:y.call(e);const a=e.fallback||e.placeholder;if(a)return a();const b=n.fallback||n.placeholder||"",_=n.fallbackTag||n.placeholderTag||"span";return f(_,d,b)}}});function _e(t){const e=Object.prototype.toString.call(t);return t instanceof Date||typeof t=="object"&&e==="[object Date]"?new t.constructor(+t):typeof t=="number"||e==="[object Number]"||typeof t=="string"||e==="[object String]"?new Date(t):new Date(NaN)}const ye=864e5;function $(t){const e=_e(t);return e.setHours(0,0,0,0),e}function O(t){const e=new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds()));return e.setUTCFullYear(t.getFullYear()),t.getTime()-e.getTime()}function he(t,e){const d=$(t),m=$(e),n=d.getTime()-O(d),a=m.getTime()-O(m);return Math.round((n-a)/ye)}const ve={class:"flex justify-content-center"},be={style:{width:"800px"}},ge=["onSubmit"],Te={class:"p-float-label mt-2"},we=u("label",{for:"searchTermInput"},"ISIN/WKN/Symbol/Name",-1),xe={key:0,class:"font-bold"},De=u("br",null,null,-1),Se={class:"text-lg font-medium flex align-items-center"},ke={class:"text-600"},qe=u("ul",null,[u("li",null,[r(" Actively maintain and develop the "),u("a",{href:"https://www.github.com/portfolio-report"},"source code on Github"),r(". ")]),u("li",null,[r(" Become member of the "),u("a",{href:"https://forum.portfolio-performance.info"},"forum"),r(" and help other users. ")]),u("li",null,[r(" Cover monthly costs for server operation and licence fees. Become sponsor on "),u("a",{href:"https://github.com/sponsors/tfabritius"},"Github"),r(". ")])],-1),Ne=I({__name:"search",setup(t){const e=ee(),d=te(),m=oe(()=>{let o="https://www.portfolio-report.net/search";return e.query&&e.query.q&&(o+=`?q=${e.query.q}`,e.query.securityType&&(o+=`&securityType=${e.query.securityType}`)),o});ne({title:"Portfolio Report Search",link:[{rel:"canonical",href:m.value}]});const n=v(""),a=v(""),b=v([]),_=v(!1),y=v(!1),k=v(!1),N=v("");R(),q(),ae(()=>e.query.q,()=>{e.query.q&&(R(),q())});async function Y(){A(),await q()}function R(){n.value=e.query.q,a.value=e.query.securityType||""}function A(){const o={q:n.value};a.value&&(o.securityType=a.value),d.push({path:e.path,query:o})}async function q(){if(n.value){y.value=!0,_.value=!1,k.value=!1;try{const o={};a.value&&(o.securityType=a.value);const s=await ie(`/securities/search/${encodeURIComponent(n.value.trim())}`,{params:o});y.value=!1,b.value=s,_.value=s.length===0}catch(o){y.value=!1,b.value=[],_.value=!1,k.value=!0,N.value=String(o)}}}function F(o){return o.markets.some(s=>s.firstPriceDate&&s.lastPriceDate)}function H(o){return o.markets.some(s=>s.lastPriceDate&&he(new Date,new Date(s.lastPriceDate))<30)}function L(o){var s;return[...new Set((s=o.markets)==null?void 0:s.map(x=>x.symbol))].filter(x=>!!x)}return(o,s)=>{const x=g("InputText"),z=me,G=g("ProgressSpinner"),E=g("Button"),K=de,B=g("Message"),C=g("Card"),Q=ue,J=g("Tag"),W=ce,M=se("tooltip");return l(),f("div",ve,[u("div",be,[h(C,null,{title:i(()=>[r(" Security Search ")]),content:i(()=>[u("form",{onSubmit:re(Y,["prevent"])},[h(K,null,{default:i(()=>[u("div",Te,[h(x,{id:"searchTermInput",modelValue:p(n),"onUpdate:modelValue":s[0]||(s[0]=c=>j(n)?n.value=c:null),type:"search",class:"w-full",autofocus:""},null,8,["modelValue"]),we]),h(z,{modelValue:p(a),"onUpdate:modelValue":s[1]||(s[1]=c=>j(a)?a.value=c:null),class:"w-full mt-4"},null,8,["modelValue"]),h(E,{type:"submit",disabled:!p(n)||p(y),class:"w-full flex justify-content-center mt-4"},{default:i(()=>[p(y)?(l(),T(G,{key:1,style:{height:"20px"}})):(l(),f("span",xe,"Search"))]),_:1},8,["disabled"])]),_:1}),p(_)?(l(),T(B,{key:0,severity:"info"},{default:i(()=>[r(" Sorry, no results were found. ")]),_:1})):S("",!0),p(k)?(l(),T(B,{key:1,severity:"error"},{default:i(()=>[r(" Sorry, there was an error:"),De,r(w(p(N)),1)]),_:1})):S("",!0)],40,ge)]),_:1}),p(b).length>0?(l(),T(C,{key:0,class:"mt-4"},{title:i(()=>[r(" Results ")]),content:i(()=>[(l(!0),f(V,null,P(p(b),c=>(l(),f("div",{key:c.uuid,class:"mb-3"},[u("div",Se,[F(c)?U((l(),f("i",{key:0,class:le(["i-carbon-chart-line mr-1",[{"text-primary":H(c)}]])},null,2)),[[M,"Prices available",void 0,{top:!0}]]):S("",!0),U((l(),T(Q,{to:`/securities/${c.uuid}`},{default:i(()=>[r(w(c.name),1)]),_:2},1032,["to"])),[[M,"Drag and drop me to Portfolio Performance!",void 0,{top:!0}]]),h(J,{class:"mx-1 bg-teal-500"},{default:i(()=>[r(w(c.securityType),1)]),_:2},1024),(l(!0),f(V,null,P(c.tags,D=>(l(),T(W,{key:D,name:D},null,8,["name"]))),128))]),u("div",ke,[r(w(c.isin)+" Â· "+w(c.wkn)+" ",1),(l(!0),f(V,null,P(L(c),(D,X)=>(l(),f("span",{key:X}," Â· "+w(D),1))),128))])]))),128))]),_:1})):S("",!0),h(C,{class:"mt-4"},{title:i(()=>[r(" Your contribution is needed ðŸ’ª ")]),content:i(()=>[r(" Your help is needed to keep this website up and running. Have you thought about contributing? You could: "),qe]),_:1})])])}}});export{Ne as default};
