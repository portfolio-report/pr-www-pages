import{_ as K}from"./TextBtn.27ae0b4e.js";import{d as M,B as P,i as s,j as W,r as d,o as C,m as $,w as r,a as t,b as y,c as O,l as G,e as B,t as U,n as x,F as J,k as Q,q as I,u as Y,D as ee,_ as te}from"./entry.abfb84f2.js";import{_ as le}from"./SelectSecurityType.vue_vue_type_script_setup_true_lang.25b832fc.js";import{b as ae,u as oe,_ as se,a as ne}from"./useConfirmDialog.42caa1cb.js";import{d as ie}from"./debounce.b2fdd475.js";import{_ as re}from"./SecurityDialog.vue_vue_type_script_setup_true_lang.dc0f86ea.js";import"./_plugin-vue_export-helper.a1a6add7.js";import"./AcceptBtn.vue_vue_type_script_setup_true_lang.cdf2e103.js";const ue={class:"mt-2"},ce={class:"mt-2"},de=M({__name:"CreateMultipleSecuritiesDialog",props:{modelValue:{type:Boolean}},emits:["update","update:modelValue"],setup(S,{emit:V}){const g=S;P(()=>g.modelValue,(l,n)=>{l===!0&&(b.value="",c.value=0)});const m=s(!1),c=s(0),b=s(""),h=W(()=>{const l=/\b([A-Z]{2})([A-Z0-9]{9})([0-9]{1})\b/g,n=[...b.value.matchAll(l)].map(f=>f[0]);return[...new Set(n)]});async function u(){m.value=!0;for(const l of h.value)await I("/securities/",{method:"post",body:{name:"",isin:l,wkn:null,securityType:null,symbolXfra:null,symbolXnas:null,symbolXnys:null}}),c.value+=1;m.value=!1}function _(l){V("update:modelValue",l),l===!1&&c.value>0&&V("update")}return(l,n)=>{const f=d("Textarea"),T=d("Chip"),k=d("Button"),w=d("Message"),D=ae,i=d("Dialog");return C(),$(i,{header:"Create multiple securities",modal:!0,style:{width:"600px"},visible:S.modelValue,"onUpdate:visible":_},{footer:r(()=>[t(D,{label:"Close",onClick:n[1]||(n[1]=p=>_(!1))})]),default:r(()=>[t(f,{modelValue:b.value,"onUpdate:modelValue":n[0]||(n[0]=p=>b.value=p),"auto-resize":!0,class:"w-full",placeholder:"Paste ISINs here"},null,8,["modelValue"]),y("div",ue,[(C(!0),O(J,null,G(x(h),p=>(C(),$(T,{key:p,class:"m-1 text-sm"},{default:r(()=>[B(U(p),1)]),_:2},1024))),128))]),y("div",ce,[t(k,{action:u,disabled:x(h).length===0,icon:"i-lg i-carbon-list-checked",label:"Create all "+x(h).length+" securities",loading:m.value},null,8,["disabled","label","loading"])]),c.value>0?(C(),$(w,{key:0,severity:"info"},{default:r(()=>[B(U(c.value)+" securities created ",1)]),_:1})):Q("",!0)]),_:1},8,["visible"])}}}),me={class:"flex align-items-center"},pe=y("h5",{class:"m-0 flex-grow-1"},"Securities",-1),_e={class:"p-input-icon-left"},fe=y("i",{class:"i-carbon-search"},null,-1),ke=M({__name:"index",setup(S){Y({title:"Portfolio Report Admin"});const V=oe(),g=s(null),m=s(!1),c=s([]),u=s({global:{value:null,matchMode:""},securityType:{value:null,matchMode:""}}),_=s(10),l=s({first:0,sortField:null,sortOrder:null}),n=e=>{l.value.first=e.first,_.value=e.rows,f(e)},f=e=>{(typeof e.sortField=="string"||typeof e.sortField>"u"||e.sortField===null)&&(l.value.sortField=e.sortField),l.value.sortOrder=e.sortOrder,i()},T=()=>{i()};P(()=>u.value.global,()=>{i()},{deep:!0}),ee(()=>{i()});const k=s(0),w=s(!1);async function D(){w.value=!0;const e=await I("/securities/",{params:{sort:l.value.sortField,skip:l.value.first,limit:_.value,desc:l.value.sortOrder===-1,search:u.value.global.value,securityType:u.value.securityType.value}});c.value=e.entries,k.value=e.params.totalCount,w.value=!1}const i=ie(D,300);async function p(){var o;const e=await((o=g.value)==null?void 0:o.show());e&&(i(),await N(e))}function z(){m.value=!0}async function N(e){var o;await((o=g.value)==null?void 0:o.show(e))&&i()}async function R(e){await V({message:`Are you sure you want to delete "${e.name}"?`,header:"Delete security"})&&(await I(`/securities/${e.uuid}`,{method:"delete"}),i())}return(e,o)=>{const A=K,X=d("InputText"),v=d("Column"),E=te,L=le,Z=se,j=ne,q=d("DataTable"),H=de;return C(),O("div",null,[t(q,{filters:u.value,"onUpdate:filters":o[1]||(o[1]=a=>u.value=a),value:c.value,lazy:!0,paginator:!0,loading:w.value,"total-records":k.value,rows:_.value,class:"p-datatable-sm","rows-per-page-options":[10,25,50,100],"sort-field":"name","sort-order":1,"filter-display":"menu",onPage:n,onSort:f,onFilter:T},{header:r(()=>[y("div",me,[pe,t(A,{icon:"i-carbon-add",onClick:p}),t(A,{icon:"i-carbon-task-add",onClick:z}),y("span",_e,[fe,t(X,{modelValue:u.value.global.value,"onUpdate:modelValue":o[0]||(o[0]=a=>u.value.global.value=a),placeholder:"Search...",type:"search"},null,8,["modelValue"])])])]),default:r(()=>[t(v,{field:"uuid",header:"UUID",sortable:!0}),t(v,{field:"name",header:"Name",sortable:!0},{body:r(({data:a})=>[t(E,{to:"/admin/securities/"+a.uuid},{default:r(()=>[B(U(a.name),1)]),_:2},1032,["to"])]),_:1}),t(v,{field:"isin",header:"ISIN",sortable:!0}),t(v,{field:"wkn",header:"WKN",sortable:!0}),t(v,{field:"securityType",header:"Type",sortable:!0,"show-filter-match-modes":!1},{filter:r(({filterModel:a})=>[t(L,{modelValue:a.value,"onUpdate:modelValue":F=>a.value=F},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(v,{header:"Actions"},{body:r(({data:a})=>[t(Z,{onClick:F=>N(a)},null,8,["onClick"]),t(j,{onClick:F=>R(a)},null,8,["onClick"])]),_:1})]),_:1},8,["filters","value","loading","total-records","rows"]),t(re,{ref_key:"securityDialog",ref:g},null,512),t(H,{modelValue:m.value,"onUpdate:modelValue":o[2]||(o[2]=a=>m.value=a),onUpdate:x(i)},null,8,["modelValue","onUpdate"])])}}});export{ke as default};
