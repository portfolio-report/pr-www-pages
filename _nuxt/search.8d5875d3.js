import{d as N,r as b,o as u,c as d,a as _,b as i,h,F as ee,u as te,G as oe,H as ne,j as ae,w as f,f as m,B as w,I as D,J as re,e as s,A as se,k as O,t as S,K as P,L as V,M as L,z as le,_ as ue}from"./entry.7235fcdb.js";import{_ as ie}from"./SecurityTag.879d08de.js";import{u as ce}from"./useApi.1a9034af.js";import"./_plugin-vue_export-helper.a1a6add7.js";const fe={class:"p-float-label"},pe=i("label",{for:"dropdown"},"Security Type",-1),me=N({__name:"SelectSecurityType",props:{modelValue:null},emits:["update:modelValue"],setup(e,{emit:t}){const l=[{text:"*",value:""},{text:"share",value:"share"},{text:"fund",value:"fund"},{text:"bond",value:"bond"},{text:"index",value:"index"}];function a(o){t("update:modelValue",o)}return(o,p)=>{const y=b("Dropdown");return u(),d("span",fe,[_(y,{id:"dropdown",class:"w-full","model-value":e.modelValue,options:l,"option-label":"text","option-value":"value","show-clear":!0,"onUpdate:modelValue":a},null,8,["model-value"]),pe])}}}),de=N({name:"ClientOnly",inheritAttrs:!1,props:["fallback","placeholder","placeholderTag","fallbackTag"],setup(e,{slots:t,attrs:l}){const a=h(!1);return ee(()=>{a.value=!0}),o=>{var g;if(a.value)return(g=t.default)==null?void 0:g.call(t);const p=t.fallback||t.placeholder;if(p)return p();const y=o.fallback||o.placeholder||"",v=o.fallbackTag||o.placeholderTag||"span";return d(v,l,y)}}});function B(e,t){if(t.length<e)throw new TypeError(e+" argument"+(e>1?"s":"")+" required, but only "+t.length+" present")}function k(e){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?k=function(l){return typeof l}:k=function(l){return l&&typeof Symbol=="function"&&l.constructor===Symbol&&l!==Symbol.prototype?"symbol":typeof l},k(e)}function ye(e){B(1,arguments);var t=Object.prototype.toString.call(e);return e instanceof Date||k(e)==="object"&&t==="[object Date]"?new Date(e.getTime()):typeof e=="number"||t==="[object Number]"?new Date(e):((typeof e=="string"||t==="[object String]")&&typeof console<"u"&&(console.warn("Starting with v2.0.0-beta.1 date-fns doesn't accept strings as date arguments. Please use `parseISO` to parse strings. See: https://github.com/date-fns/date-fns/blob/master/docs/upgradeGuide.md#string-arguments"),console.warn(new Error().stack)),new Date(NaN))}function U(e){var t=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()));return t.setUTCFullYear(e.getFullYear()),e.getTime()-t.getTime()}function Y(e){B(1,arguments);var t=ye(e);return t.setHours(0,0,0,0),t}var _e=864e5;function he(e,t){B(2,arguments);var l=Y(e),a=Y(t),o=l.getTime()-U(l),p=a.getTime()-U(a);return Math.round((o-p)/_e)}const ve={class:"flex justify-content-center"},be={style:{width:"800px"}},ge=["onSubmit"],we={class:"p-float-label mt-2"},Se=i("label",{for:"searchTermInput"},"ISIN/WKN/Symbol/Name",-1),Te={key:0,class:"font-bold"},xe=i("br",null,null,-1),De={class:"text-lg font-medium flex align-items-center"},ke={class:"text-600"},Ce=i("ul",null,[i("li",null,[s(" Actively maintain and develop the "),i("a",{href:"https://www.github.com/portfolio-report"},"source code on Github"),s(". ")]),i("li",null,[s(" Become member of the "),i("a",{href:"https://forum.portfolio-performance.info"},"forum"),s(" and help other users. ")]),i("li",null,[s(" Cover monthly costs for server operation and licence fees. Become sponsor on "),i("a",{href:"https://github.com/sponsors/tfabritius"},"Github"),s(". ")])],-1),Be=N({__name:"search",setup(e){te({title:"Portfolio Report Search"});const t=oe(),l=ne(),a=h(""),o=h(""),p=h([]),y=h(!1),v=h(!1),g=h(!1),M=h("");R(),C(),ae(()=>t.query.q,()=>{t.query.q&&(R(),C())});async function F(){j(),await C()}function R(){a.value=t.query.q,o.value=t.query.securityType||""}function j(){const n={q:a.value};o.value&&(n.securityType=o.value),l.push({path:t.path,query:n})}async function C(){if(!!a.value){v.value=!0,y.value=!1,g.value=!1;try{const n={};o.value&&(n.securityType=o.value);const r=await ce(`/securities/search/${encodeURIComponent(a.value.trim())}`,{params:n});v.value=!1,p.value=r,y.value=r.length===0}catch(n){v.value=!1,p.value=[],y.value=!1,g.value=!0,M.value=String(n)}}}function H(n){return n.markets.some(r=>r.firstPriceDate&&r.lastPriceDate)}function $(n){return n.markets.some(r=>r.lastPriceDate&&he(new Date,new Date(r.lastPriceDate))<30)}function E(n){var r;return[...new Set([n.symbolXfra,n.symbolXnas,n.symbolXnys,...(r=n.markets)==null?void 0:r.map(T=>T.symbol)])].filter(T=>!!T)}return(n,r)=>{const T=b("InputText"),G=me,z=b("ProgressSpinner"),X=b("Button"),K=de,q=b("Message"),I=b("Card"),Q=ue,J=b("Tag"),W=ie,A=re("tooltip");return u(),d("div",ve,[i("div",be,[_(I,null,{title:f(()=>[s("Security Search")]),content:f(()=>[i("form",{onSubmit:se(F,["prevent"])},[_(K,null,{default:f(()=>[i("div",we,[_(T,{id:"searchTermInput",modelValue:m(a),"onUpdate:modelValue":r[0]||(r[0]=c=>O(a)?a.value=c:null),type:"search",class:"w-full",autofocus:""},null,8,["modelValue"]),Se]),_(G,{modelValue:m(o),"onUpdate:modelValue":r[1]||(r[1]=c=>O(o)?o.value=c:null),class:"w-full mt-4"},null,8,["modelValue"]),_(X,{type:"submit",disabled:!m(a)||m(v),class:"w-full flex justify-content-center mt-4"},{default:f(()=>[m(v)?(u(),w(z,{key:1,style:{height:"20px"}})):(u(),d("span",Te,"Search"))]),_:1},8,["disabled"])]),_:1}),m(y)?(u(),w(q,{key:0,severity:"info"},{default:f(()=>[s(" Sorry, no results were found. ")]),_:1})):D("",!0),m(g)?(u(),w(q,{key:1,severity:"error"},{default:f(()=>[s(" Sorry, there was an error:"),xe,s(S(m(M)),1)]),_:1})):D("",!0)],40,ge)]),_:1}),m(p).length>0?(u(),w(I,{key:0,class:"mt-4"},{title:f(()=>[s("Results")]),content:f(()=>[(u(!0),d(P,null,V(m(p),c=>(u(),d("div",{key:c.uuid,class:"mb-3"},[i("div",De,[H(c)?L((u(),d("i",{key:0,class:le(["i-carbon-chart-line","mr-1",{"text-primary":$(c)}])},null,2)),[[A,"Prices available",void 0,{top:!0}]]):D("",!0),L((u(),w(Q,{to:"/securities/"+c.uuid},{default:f(()=>[s(S(c.name),1)]),_:2},1032,["to"])),[[A,"Drag and drop me to Portfolio Performance!",void 0,{top:!0}]]),_(J,{class:"mx-1 bg-teal-500"},{default:f(()=>[s(S(c.securityType),1)]),_:2},1024),(u(!0),d(P,null,V(c.tags,x=>(u(),w(W,{key:x,name:x},null,8,["name"]))),128))]),i("div",ke,[s(S(c.isin)+" \xB7 "+S(c.wkn)+" ",1),(u(!0),d(P,null,V(E(c),(x,Z)=>(u(),d("span",{key:Z}," \xB7 "+S(x),1))),128))])]))),128))]),_:1})):D("",!0),_(I,{class:"mt-4"},{title:f(()=>[s("Your contribution is needed \u{1F4AA}")]),content:f(()=>[s(" Your help is needed to keep this website up and running. Have you thought about contributing? You could: "),Ce]),_:1})])])}}});export{Be as default};
