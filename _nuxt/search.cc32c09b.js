import{h as N,l as b,t as l,m as f,q as h,x as u,r as v,B as te,C as ne,D as oe,c as ae,j as re,w as se,E as le,s as c,u as p,F as w,G as D,v as s,z as ue,i as $,H as S,I,J as P,K as A,y as ie,_ as ce}from"./entry.8516b0a3.js";import{_ as pe}from"./SecurityTag.f70d5bd5.js";import{u as fe}from"./useApi.900e5aff.js";import"./_plugin-vue_export-helper.c27b6911.js";const me={class:"p-float-label"},de=u("label",null,"Security Type",-1),ye=N({__name:"SelectSecurityType",props:{modelValue:{}},emits:["update:modelValue"],setup(t,{emit:e}){const d=e,m=[{text:"*",value:""},{text:"share",value:"share"},{text:"fund",value:"fund"},{text:"bond",value:"bond"},{text:"index",value:"index"}];function o(a){d("update:modelValue",a)}return(a,g)=>{const y=b("Dropdown");return l(),f("span",me,[h(y,{class:"w-full","model-value":a.modelValue,options:m,"option-label":"text","option-value":"value","show-clear":!0,"onUpdate:modelValue":o},null,8,["model-value"]),de])}}}),_e=N({name:"ClientOnly",inheritAttrs:!1,props:["fallback","placeholder","placeholderTag","fallbackTag"],setup(t,{slots:e,attrs:d}){const m=v(!1);return te(()=>{m.value=!0}),o=>{var _;if(m.value)return(_=e.default)==null?void 0:_.call(e);const a=e.fallback||e.placeholder;if(a)return a();const g=o.fallback||o.placeholder||"",y=o.fallbackTag||o.placeholderTag||"span";return f(y,d,g)}}});function V(t){"@babel/helpers - typeof";return V=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},V(t)}function R(t,e){if(e.length<t)throw new TypeError(t+" argument"+(t>1?"s":"")+" required, but only "+e.length+" present")}function he(t){R(1,arguments);var e=Object.prototype.toString.call(t);return t instanceof Date||V(t)==="object"&&e==="[object Date]"?new Date(t.getTime()):typeof t=="number"||e==="[object Number]"?new Date(t):((typeof t=="string"||e==="[object String]")&&typeof console<"u"&&(console.warn("Starting with v2.0.0-beta.1 date-fns doesn't accept strings as date arguments. Please use `parseISO` to parse strings. See: https://github.com/date-fns/date-fns/blob/master/docs/upgradeGuide.md#string-arguments"),console.warn(new Error().stack)),new Date(NaN))}function Y(t){var e=new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds()));return e.setUTCFullYear(t.getFullYear()),t.getTime()-e.getTime()}function L(t){R(1,arguments);var e=he(t);return e.setHours(0,0,0,0),e}var ve=864e5;function ge(t,e){R(2,arguments);var d=L(t),m=L(e),o=d.getTime()-Y(d),a=m.getTime()-Y(m);return Math.round((o-a)/ve)}const be={class:"flex justify-content-center"},we={style:{width:"800px"}},Se=["onSubmit"],Te={class:"p-float-label mt-2"},xe=u("label",{for:"searchTermInput"},"ISIN/WKN/Symbol/Name",-1),De={key:0,class:"font-bold"},ke=u("br",null,null,-1),qe={class:"text-lg font-medium flex align-items-center"},Ce={class:"text-600"},Ie=u("ul",null,[u("li",null,[s(" Actively maintain and develop the "),u("a",{href:"https://www.github.com/portfolio-report"},"source code on Github"),s(". ")]),u("li",null,[s(" Become member of the "),u("a",{href:"https://forum.portfolio-performance.info"},"forum"),s(" and help other users. ")]),u("li",null,[s(" Cover monthly costs for server operation and licence fees. Become sponsor on "),u("a",{href:"https://github.com/sponsors/tfabritius"},"Github"),s(". ")])],-1),Me=N({__name:"search",setup(t){const e=ne(),d=oe(),m=ae(()=>{let n="https://www.portfolio-report.net/search";return e.query&&e.query.q&&(n+=`?q=${e.query.q}`,e.query.securityType&&(n+=`&securityType=${e.query.securityType}`)),n});re({title:"Portfolio Report Search",link:[{rel:"canonical",href:m.value}]});const o=v(""),a=v(""),g=v([]),y=v(!1),_=v(!1),k=v(!1),M=v("");B(),q(),se(()=>e.query.q,()=>{e.query.q&&(B(),q())});async function j(){E(),await q()}function B(){o.value=e.query.q,a.value=e.query.securityType||""}function E(){const n={q:o.value};a.value&&(n.securityType=a.value),d.push({path:e.path,query:n})}async function q(){if(o.value){_.value=!0,y.value=!1,k.value=!1;try{const n={};a.value&&(n.securityType=a.value);const r=await fe(`/securities/search/${encodeURIComponent(o.value.trim())}`,{params:n});_.value=!1,g.value=r,y.value=r.length===0}catch(n){_.value=!1,g.value=[],y.value=!1,k.value=!0,M.value=String(n)}}}function F(n){return n.markets.some(r=>r.firstPriceDate&&r.lastPriceDate)}function H(n){return n.markets.some(r=>r.lastPriceDate&&ge(new Date,new Date(r.lastPriceDate))<30)}function G(n){var r;return[...new Set((r=n.markets)==null?void 0:r.map(T=>T.symbol))].filter(T=>!!T)}return(n,r)=>{const T=b("InputText"),z=ye,K=b("ProgressSpinner"),Q=b("Button"),J=_e,O=b("Message"),C=b("Card"),W=ce,X=b("Tag"),Z=pe,U=le("tooltip");return l(),f("div",be,[u("div",we,[h(C,null,{title:c(()=>[s(" Security Search ")]),content:c(()=>[u("form",{onSubmit:ue(j,["prevent"])},[h(J,null,{default:c(()=>[u("div",Te,[h(T,{id:"searchTermInput",modelValue:p(o),"onUpdate:modelValue":r[0]||(r[0]=i=>$(o)?o.value=i:null),type:"search",class:"w-full",autofocus:""},null,8,["modelValue"]),xe]),h(z,{modelValue:p(a),"onUpdate:modelValue":r[1]||(r[1]=i=>$(a)?a.value=i:null),class:"w-full mt-4"},null,8,["modelValue"]),h(Q,{type:"submit",disabled:!p(o)||p(_),class:"w-full flex justify-content-center mt-4"},{default:c(()=>[p(_)?(l(),w(K,{key:1,style:{height:"20px"}})):(l(),f("span",De,"Search"))]),_:1},8,["disabled"])]),_:1}),p(y)?(l(),w(O,{key:0,severity:"info"},{default:c(()=>[s(" Sorry, no results were found. ")]),_:1})):D("",!0),p(k)?(l(),w(O,{key:1,severity:"error"},{default:c(()=>[s(" Sorry, there was an error:"),ke,s(S(p(M)),1)]),_:1})):D("",!0)],40,Se)]),_:1}),p(g).length>0?(l(),w(C,{key:0,class:"mt-4"},{title:c(()=>[s(" Results ")]),content:c(()=>[(l(!0),f(I,null,P(p(g),i=>(l(),f("div",{key:i.uuid,class:"mb-3"},[u("div",qe,[F(i)?A((l(),f("i",{key:0,class:ie(["i-carbon-chart-line mr-1",[{"text-primary":H(i)}]])},null,2)),[[U,"Prices available",void 0,{top:!0}]]):D("",!0),A((l(),w(W,{to:`/securities/${i.uuid}`},{default:c(()=>[s(S(i.name),1)]),_:2},1032,["to"])),[[U,"Drag and drop me to Portfolio Performance!",void 0,{top:!0}]]),h(X,{class:"mx-1 bg-teal-500"},{default:c(()=>[s(S(i.securityType),1)]),_:2},1024),(l(!0),f(I,null,P(i.tags,x=>(l(),w(Z,{key:x,name:x},null,8,["name"]))),128))]),u("div",Ce,[s(S(i.isin)+" Â· "+S(i.wkn)+" ",1),(l(!0),f(I,null,P(G(i),(x,ee)=>(l(),f("span",{key:ee}," Â· "+S(x),1))),128))])]))),128))]),_:1})):D("",!0),h(C,{class:"mt-4"},{title:c(()=>[s(" Your contribution is needed ðŸ’ª ")]),content:c(()=>[s(" Your help is needed to keep this website up and running. Have you thought about contributing? You could: "),Ie]),_:1})])])}}});export{Me as default};
